{"compress":true,"commitItems":[["5f8082a6-7e50-48e6-949c-5e8b33e21c4f",1519785173740,"## 学校 Schools\n\n学校仅超级管理员可以维护，数据不会经常做改变，如后期用户数量巨大，可以考虑使用缓存。\n学校对应有单一取货点，用于订单流程。\n不考虑学校定位，游客必须手动选择某一学校后才能访问书本。\n\n### 字段设计\nname——学校的名称\ndepot——取货点\n\n## 用户 Users\n\n包含普通的用户验证字段，登录信息记录字段，包含微信自动登录标识\n\n### 字段设计\n\n身份验证字段\nbalance——用户余额\nschool_id——关联学校\nnotification_count——消息通知数量\nlast_actived_at——最后活跃时间\nalipay——支付宝账号\n时间字段[^1]\n\n## 用户余额 UserBalance\n\n\b用户余额比较重要，单独扩展一个模型用于记录\n\n### 字段设计\n\n时间字段\namount——变动金额\ntype——变动类型：入账、提现\nuser_id——关联用户\n\n## 书本 Books\n\n可由用户发布，考虑易用性，只需要上传一张封面图片。\n不考虑数量，只关心是否已售。\n不考虑管理员对列表进行排序，采用管理员推荐到首页的形式\n\n### 字段设计\n\nISBN——书本码\nname——书名`搜索依据`\nimage——封面\nauthor——作者\npress——出版社\npublished_at——出版时间\nused——新旧程度\ncategory_id——关联分类\nschool_id——关联学校\noriginal_price——原价\nprice——售价\ndescription——文字描述\nstatus——书本状态：待审核、审核通过、审核不通过、已售\nis_show——上下架状态\nis_recommend——推荐状态\nadmin_id——关联管理员\nuser_id——关联用户\n时间字段\n\n## 分类 Categories\n\n书本的类别，只有超级管理员维护。系统默认生成一下几个：课本教材、课外读物、考研书籍\n\n### 字段设计\n\nname——分类名称\n时间字段\n\n## 订单 Orders\n\n订单创建及发起付款时，书本状态必须为`已通过审核`。\n如订单未付款，需要考虑书本状态变化时同步改变订单状态。\n\n订单状态：\n1. 待付款——此时卖家可以查看\n2. 待确认——卖家需要进行订单确认\n3. 待发货——等待卖家送书\n4. 待取货——等待买家取书\n5. 已完成\n6. 已取消\n7. 已失效`新增状态`\n\n### 字段设计\n\nsn——订单唯一编码，用于关联外部系统\nmessage——买家留言\nbook_id——关联书本\nseller_id——关联卖家\nuser_id——关联买家\nschool_id——关联学校`有可能出现买卖双方不在同一学校，关联的是卖家的学校`\nprice——订单金额：方便统计\npayed_amount——付款金额：方便与微信对账，及后期扩展\npayed_at——付款时间`做订单统计的时间口径将以此为准`\nout_sn——微信支付唯一编码`人工退款依据`\n时间字段\n\n## 订单日志 OrderLogs\n\n由于订单状态比较复杂，我们单独扩展一个模型用于管理订单状态\n订单也将通过这个模型更好的关联到消息通知模块\n相应的订单日志创建时触发消息通知的扳机\n\n订单的操作类型包括：\n1. 买家下单\n2. 买家付款（产生通知）\n3. 卖家确认（产生通知）\n4. 卖家送达（产生通知）\n5. 买家取书或者叫卖家入账（产生通知）\n6. 订单取消\n\n订单操作人包括：\n1. 买家\n2. 卖家\n3. 管理员\n\n由于管理员和用户不属于同一模块，所以我们只是抽象的记录角色，并不具体关联到模型\n通知内容由关联订单决定，这里只是做一下传递\n\n### 字段设计\n\n时间字段\ntype——订单操作类型\norder_id——关联订单\noperator——操作角色\n\n## 提现申请 Transfer\n\n提现申请仅作为后台打款依据，无论状态如何用户余额都已经扣除。\n\n### 字段设计\n\nstatus——提现状态：待打款、已打款\nadmin_id——关联管理员\nuser_id——关联用户\namount——提现金额\npayed_at——人工打款时间\n时间字段\n\n## 消息通知 Notifications\n\n系统自建\n\n##  广告 Ads\n\n不考虑使用广告盈利，广告位置较少\n`广告不考虑关联到学校`，无论在哪个学校所看到的广告都是相同的\n\n### 字段设计\n\nname——标题\nimage——图片\nurl——链接\nsort——手动排序\n时间字段\n\n## 文章 Articles\n\n由超级管理员维护的文章，本项目中定位类似于帮助中心\n不考虑关联到分类\n不考虑 SEO\n\n### 字段设计\nname——标题\ncontent——富文本内容\n时间字段\n\n\n\n\n\n\n\n\n\n\n\n[^1]:如信息添加时间、修改时间等\n",[[1519785137867,["fourn@MacBookPro.local",[[-1,284,"alipay——支付宝账号"]],[284,297],[284,284]]],[1519785138882,["fourn@MacBookPro.local",[[1,217,"\n"]],[216,216],[217,217]]],[1519785139087,["fourn@MacBookPro.local",[[1,217,"alipay——支付宝账号"]],[217,217],[230,230]]],[1519785140435,["fourn@MacBookPro.local",[[-1,274,"last_actived_at——最后活跃时间"]],[230,230],[274,274]]],[1519785141504,["fourn@MacBookPro.local",[[1,231,"\n"]],[230,230],[231,231]]],[1519785141706,["fourn@MacBookPro.local",[[1,231,"last_actived_at——最后活跃时间"]],[231,231],[254,254]]],[1519785143476,["fourn@MacBookPro.local",[[-1,271,"notification_count——消息通知数量"]],[271,297],[271,271]]],[1519785144263,["fourn@MacBookPro.local",[[1,255,"\n"]],[254,254],[255,255]]],[1519785144426,["fourn@MacBookPro.local",[[1,255,"notification_count——消息通知数量"]],[255,255],[281,281]]],[1519785145849,["fourn@MacBookPro.local",[[-1,300,"\n"]],[300,300],[299,299]]],[1519785146041,["fourn@MacBookPro.local",[[-1,299,"\n"]],[299,299],[298,298]]],[1519785146863,["fourn@MacBookPro.local",[[-1,298,"\n"]],[298,298],[297,297]]],[1519982406220,["fourn@MacBookPro.local",[[1,510,"d"]],[510,510],[511,511]]],[1519982406931,["fourn@MacBookPro.local",[[-1,510,"d"]],[511,511],[510,510]]],[1519982410509,["fourn@MacBookPro.local",[[1,510,":string"]],[510,510],[517,517]]],[1519982444901,["fourn@MacBookPro.local",[[1,527,":string:index"]],[527,527],[540,540]]],[1519982453036,["fourn@MacBookPro.local",[[1,556,":text"]],[556,556],[561,561]]],[1519982456030,["fourn@MacBookPro.local",[[1,572,":sr"]],[572,572],[575,575]]],[1519982456602,["fourn@MacBookPro.local",[[-1,574,"r"]],[575,575],[574,574]]],[1519982457764,["fourn@MacBookPro.local",[[1,574,"tring"]],[574,574],[579,579]]],[1519982462203,["fourn@MacBookPro.local",[[1,589,":st"]],[589,589],[592,592]]],[1519982463203,["fourn@MacBookPro.local",[[1,592,"rubg"]],[592,592],[596,596]]],[1519982464275,["fourn@MacBookPro.local",[[-1,593,"ubg"]],[596,596],[593,593]]],[1519982465141,["fourn@MacBookPro.local",[[1,593,"ing"]],[593,593],[596,596]]],[1519982505436,["fourn@MacBookPro.local",[[1,614,":string"]],[614,614],[621,621]]],[1519982507107,["fourn@MacBookPro.local",[[-1,615,"string"]],[621,621],[615,615]]],[1519982509070,["fourn@MacBookPro.local",[[1,615,"string"]],[615,615],[621,621]]],[1519982510419,["fourn@MacBookPro.local",[[-1,615,"string"]],[621,621],[615,615]]],[1519982511901,["fourn@MacBookPro.local",[[1,615,"dateTime"]],[615,615],[623,623]]],[1519982599360,["fourn@MacBookPro.local",[[1,634,":string"]],[634,634],[641,641]]],[1519982619562,["fourn@MacBookPro.local",[[1,659,":integer:unsigned:index"]],[659,659],[682,682]]],[1519982625594,["fourn@MacBookPro.local",[[1,698,":integer:unsigned:index"]],[698,698],[721,721]]],[1519982628469,["fourn@MacBookPro.local",[[1,742,":"]],[742,742],[743,743]]],[1519982657548,["fourn@MacBookPro.local",[[-1,602,"published_at:dateTime"],[1,623,"timestamp"]],[602,623],[611,611]]],[1519982658042,["fourn@MacBookPro.local",[[1,602,"published_at:dateTime"],[-1,602,"timestamp"]],[611,611],[602,623]]],[1519982659959,["fourn@MacBookPro.local",[[-1,615,"da"],[-1,618,"eT"],[1,623,"stamp"]],[615,623],[624,624]]],[1519982680022,["fourn@MacBookPro.local",[[1,744,"decimal()"]],[744,744],[753,753]]],[1519982681653,["fourn@MacBookPro.local",[[1,752,"8,2"]],[752,752],[755,755]]],[1519982686632,["fourn@MacBookPro.local",[[1,766,":decimal(8,2)"]],[766,766],[779,779]]],[1519982700957,["fourn@MacBookPro.local",[[1,795,":text:nullal"]],[795,795],[807,807]]],[1519982701963,["fourn@MacBookPro.local",[[-1,804,"lal"]],[807,807],[804,804]]],[1519982703191,["fourn@MacBookPro.local",[[1,804,"lab"]],[804,804],[807,807]]],[1519982703429,["fourn@MacBookPro.local",[[1,807,"kle"]],[807,807],[810,810]]],[1519982704319,["fourn@MacBookPro.local",[[-1,807,"kle"]],[810,810],[807,807]]],[1519982704950,["fourn@MacBookPro.local",[[1,807,"le"]],[807,807],[809,809]]],[1519982712237,["fourn@MacBookPro.local",[[1,822,":int"]],[822,822],[826,826]]],[1519982713260,["fourn@MacBookPro.local",[[-1,823,"int"]],[826,826],[823,823]]],[1519982721798,["fourn@MacBookPro.local",[[1,823,"integer:index:"]],[823,823],[837,837]]],[1519982728470,["fourn@MacBookPro.local",[[-1,830,":index:"]],[837,837],[830,830]]],[1519982735319,["fourn@MacBookPro.local",[[1,862,":integer"]],[862,862],[870,870]]],[1519982742996,["fourn@MacBookPro.local",[[1,890,":integer"]],[890,890],[898,898]]],[1519982771819,["fourn@MacBookPro.local",[[1,823,"t"],[1,824,"nyI"]],[823,830],[834,834]]],[1519982776224,["fourn@MacBookPro.local",[[1,867,"t"],[1,868,"nyI"]],[867,874],[878,878]]],[1519982779757,["fourn@MacBookPro.local",[[1,899,"t"],[1,900,"nyI"]],[899,906],[910,910]]],[1519982820447,["fourn@MacBookPro.local",[[-1,649,"category_id:integer:unsigned:index——关联分类\nschool_id:integer:unsigned:index——关联学校"]],[649,728],[649,649]]],[1519982823499,["fourn@MacBookPro.local",[[1,838,"\n"]],[837,837],[838,838]]],[1519982823654,["fourn@MacBookPro.local",[[1,838,"category_id:integer:unsigned:index——关联分类\nschool_id:integer:unsigned:index——关联学校"]],[838,838],[917,917]]],[1519982837478,["fourn@MacBookPro.local",[[1,926,":integer:unsigned:nullable"]],[926,926],[952,952]]],[1519982844154,["fourn@MacBookPro.local",[[1,967,":integer:unsigned:index"]],[967,967],[990,990]]],[1519982845710,["fourn@MacBookPro.local",[[-1,960,"user_id:integer:unsigned:index——关联用户"]],[960,996],[960,960]]],[1519982846733,["fourn@MacBookPro.local",[[1,838,"\n"]],[837,837],[838,838]]],[1519982846912,["fourn@MacBookPro.local",[[1,838,"user_id:integer:unsigned:index——关联用户"]],[838,838],[874,874]]],[1519982848565,["fourn@MacBookPro.local",[[-1,997,"\n"]],[997,997],[996,996]]],[1519982954189,["fourn@MacBookPro.local",[[1,997,"\n"]],[996,996],[997,997]]],[1519982954884,["fourn@MacBookPro.local",[[-1,838,"user_id:integer:unsigned:index——关联用户"]],[874,874],[838,838]]],[1519982955549,["fourn@MacBookPro.local",[[1,838,"user_id:integer:unsigned:index——关联用户"]],[838,838],[874,874]]],[1519982955845,["fourn@MacBookPro.local",[[-1,997,"\n"]],[997,997],[996,996]]],[1519982958784,["fourn@MacBookPro.local",[[-1,649,"\n"]],[649,649],[648,648]]],[1519982998066,["fourn@MacBookPro.local",[[1,754,":default()"]],[754,754],[764,764]]],[1519983005043,["fourn@MacBookPro.local",[[1,763,"0"]],[763,763],[764,764]]],[1519983007006,["fourn@MacBookPro.local",[[-1,763,"0"]],[764,764],[763,763]]],[1519983007145,["fourn@MacBookPro.local",[[1,763,"1"]],[763,763],[764,764]]],[1519983023887,["fourn@MacBookPro.local",[[-1,763,"1"]],[764,764],[763,763]]],[1519983024128,["fourn@MacBookPro.local",[[1,763,"0"]],[763,763],[764,764]]],[1519983025233,["fourn@MacBookPro.local",[[-1,763,"0"]],[764,764],[763,763]]],[1519983025723,["fourn@MacBookPro.local",[[1,763,"1"]],[763,763],[764,764]]],[1519983030319,["fourn@MacBookPro.local",[[-1,763,"1"]],[764,764],[763,763]]],[1519983030568,["fourn@MacBookPro.local",[[1,763,"0"]],[763,763],[764,764]]],[1519983034344,["fourn@MacBookPro.local",[[-1,763,"0"]],[764,764],[763,763]]],[1519983034480,["fourn@MacBookPro.local",[[1,763,"1"]],[763,763],[764,764]]],[1519983041976,["fourn@MacBookPro.local",[[1,809,":default()"]],[809,809],[819,819]]],[1519983042808,["fourn@MacBookPro.local",[[1,818,"1"]],[818,818],[819,819]]],[1519983047719,["fourn@MacBookPro.local",[[-1,818,"1"]],[819,819],[818,818]]],[1519983047833,["fourn@MacBookPro.local",[[1,818,"2"]],[818,818],[819,819]]],[1519983055050,["fourn@MacBookPro.local",[[1,852,":default(2)"]],[852,852],[863,863]]],[1519983082513,["fourn@MacBookPro.local",[[-1,506,"ISBN"],[1,510,"sn"]],[506,510],[508,508]]],[1519983101154,["fourn@MacBookPro.local",[[1,1032,"sn:string,name:string:index,image:text."]],[1032,1032],[1071,1071]]],[1519983101840,["fourn@MacBookPro.local",[[-1,1070,"."]],[1071,1071],[1070,1070]]],[1519983127604,["fourn@MacBookPro.local",[[1,1070,",author:string,press:string,published_at:timestamp,used:string,original_price:decimal(8,2)"]],[1070,1070],[1160,1160]]],[1519983178610,["fourn@MacBookPro.local",[[1,1160,",price:decimal(8,2),description:text:nullable,status:tinyInteger:default(1),is_show:tinyInteger:default(2),is_recommend:tinyInteger:default(2),user_id:integer:unsigned:index,category_id:integer:unsigned:index,school_id:integer:unsigned:index,admin_id:integer:unsigned:nullable"]],[1160,1160],[1436,1436]]],[1519983237208,["fourn@MacBookPro.local",[[1,1032,"\n"]],[1031,1031],[1032,1032]]],[1519983240337,["fourn@MacBookPro.local",[[1,1033,"\n"]],[1032,1032],[1033,1033]]],[1519983240882,["fourn@MacBookPro.local",[[1,1034,"\n"]],[1033,1033],[1034,1034]]],[1519983244267,["fourn@MacBookPro.local",[[1,1033,"### s"]],[1033,1033],[1038,1038]]],[1519983244776,["fourn@MacBookPro.local",[[-1,1037,"s"]],[1038,1038],[1037,1037]]],[1519983246428,["fourn@MacBookPro.local",[[1,1037,"数据估价"]],[1037,1037],[1041,1041]]],[1519983247360,["fourn@MacBookPro.local",[[-1,1037,"数据估价"]],[1041,1041],[1037,1037]]],[1519983248651,["fourn@MacBookPro.local",[[1,1037,"骨架"]],[1037,1037],[1039,1039]]],[1520216811655,["fourn@MacBookPro.local",[[1,1037,"s"]],[1037,1037],[1038,1038]]],[1520216812171,["fourn@MacBookPro.local",[[-1,1037,"s"]],[1038,1038],[1037,1037]]],[1520216812776,["fourn@MacBookPro.local",[[1,1037,"是"]],[1037,1037],[1038,1038]]],[1520216813146,["fourn@MacBookPro.local",[[-1,1037,"是"]],[1038,1038],[1037,1037]]],[1520216813836,["fourn@MacBookPro.local",[[1,1037,"数据"]],[1037,1037],[1039,1039]]],[1520818438086,["fourn@MacBookPro.local",[[1,2747,"\n"]],[2746,2746],[2747,2747]]],[1520818438197,["fourn@MacBookPro.local",[[1,2748,"\n"]],[2747,2747],[2748,2748]]],[1520818438559,["fourn@MacBookPro.local",[[1,2747,"d"]],[2747,2747],[2748,2748]]],[1520818438742,["fourn@MacBookPro.local",[[-1,2747,"d"]],[2748,2748],[2747,2747]]],[1520820089233,[null,[[1,1718,":string:index"],[1,1743,":text:nullable"],[1,1757,":integer:index"],[1,1773,":integer:index"],[1,1787,":integer:index"],[1,1803,":integer:index"],[1,1842,":decimal(8,2)"],[1,1866,":decimal(8,2):default(0)"],[1,1895,":timestamp:nullable"],[1,1925,":string:nullable"],[1,1944,"name:string——订单名称\nimage:text——订单图片\n"],[1,1948,"\n\n### 数据骨架\nsn:string:index,message:text:nullable,book_id:integer:index,seller_id:integer:index,user_id:integer:index,school_id:integer:index,price:decimal(8,2),payed_amount:decimal(8,2):default(0),payed_at:timestamp:nullable,out_sn:string:nullable,name:string,image:text\n\n"],[1,2285,"\n\n"],[-1,2705,"\n\nd"]],[1718,1718],[2705,2705]]],[1520820089233,[null,[[-1,1718,":string:index"],[-1,1756,":text:nullable"],[-1,1784,":integer:index"],[-1,1814,":integer:index"],[-1,1842,":integer:index"],[-1,1872,":integer:index"],[-1,1925,":decimal(8,2)"],[-1,1962,":decimal(8,2):default(0)"],[-1,2015,":timestamp:nullable"],[-1,2064,":string:nullable"],[-1,2099,"name:string——订单名称\nimage:text——订单图片\n"],[-1,2138,"\n\n### 数据骨架\nsn:string:index,message:text:nullable,book_id:integer:index,seller_id:integer:index,user_id:integer:index,school_id:integer:index,price:decimal(8,2),payed_amount:decimal(8,2):default(0),payed_at:timestamp:nullable,out_sn:string:nullable,name:string,image:text\n\n"],[-1,2747,"\n\n"],[1,3169,"\n\nd"]],[2705,2705],[1718,1718]]],[1520820081886,["fourn@MacBookPro.local",[[1,2133,"\\"]],[2133,2133],[2134,2134]]],[1520820082740,["fourn@MacBookPro.local",[[-1,2133,"\\"]],[2134,2134],[2133,2133]]],[1520820082915,["fourn@MacBookPro.local",[[1,2134,"\n"]],[2133,2133],[2134,2134]]],[1520820085285,["fourn@MacBookPro.local",[[1,2134,"status:"]],[2134,2134],[2141,2141]]],[1520820151278,[null,[[1,1718,":string:index"],[1,1743,":text:nullable"],[1,1757,":integer:index"],[1,1773,":integer:index"],[1,1787,":integer:index"],[1,1803,":integer:index"],[1,1842,":decimal(8,2)"],[1,1866,":decimal(8,2):default(0)"],[1,1895,":timestamp:nullable"],[1,1925,":string:nullable"],[1,1944,"name:string——订单名称\nimage:text——订单图片\nstatus:\n"],[1,1948,"\n\n### 数据骨架\nsn:string:index,message:text:nullable,book_id:integer:index,seller_id:integer:index,user_id:integer:index,school_id:integer:index,price:decimal(8,2),payed_amount:decimal(8,2):default(0),payed_at:timestamp:nullable,out_sn:string:nullable,name:string,image:text\n\n"],[-1,2134,"status:\n"],[1,2293,"\n\n"],[-1,2713,"\n\nd"]],[1718,1718],[2713,2713]]],[1520820151278,[null,[[-1,1718,":string:index"],[-1,1756,":text:nullable"],[-1,1784,":integer:index"],[-1,1814,":integer:index"],[-1,1842,":integer:index"],[-1,1872,":integer:index"],[-1,1925,":decimal(8,2)"],[-1,1962,":decimal(8,2):default(0)"],[-1,2015,":timestamp:nullable"],[-1,2064,":string:nullable"],[-1,2099,"name:string——订单名称\nimage:text——订单图片\nstatus:\n"],[-1,2146,"\n\n### 数据骨架\nsn:string:index,message:text:nullable,book_id:integer:index,seller_id:integer:index,user_id:integer:index,school_id:integer:index,price:decimal(8,2),payed_amount:decimal(8,2):default(0),payed_at:timestamp:nullable,out_sn:string:nullable,name:string,image:text\n\n"],[1,2604,"status:\n"],[-1,2755,"\n\n"],[1,3177,"\n\nd"]],[2713,2713],[1718,1718]]],[1520820098470,["fourn@MacBookPro.local",[[1,2141,"integer:index"]],[2141,2141],[2154,2154]]],[1520820101532,["fourn@MacBookPro.local",[[1,2429,",status:integer:index"]],[2429,2429],[2450,2450]]],[1520820107103,["fourn@MacBookPro.local",[[1,2154,"——订单状态"]],[2154,2154],[2160,2160]]]]]]}